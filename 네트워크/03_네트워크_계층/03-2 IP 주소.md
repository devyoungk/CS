# IP 주소

IP 주소는 크게 네트워크 주소와 호스트 주소로 이루어진다.

네트워크 주소는 호스트가 속한 특정 네트워크를 식별하는 역할,

호스트 주소는 네트워크 내에서 특정 호스트를 식별하는 역할을 한다.

<br>

## 네트워크 주소와 호스트 주소

네트워크 주소 : 네트워크 ID, 네트워크 식별자 등으로 부른다.

호스트 주소 : 호스트 ID, 호스트 식별자 등으로 부른다.

Ex) 172.16.12.45 / 172.46 → 네트워크 주소, 12.45 → 호스트 주소

<br>

네트워크 주소가 얼마만큼 차지 하냐에 따라 호스트에 IP 주소를 할당할 수 있는 수가 달라진다.

하나의 IP 주소에 호스트 주소의 공간을 얼마나 할당하는 것이 좋을까?

→ IP 주소의 클래스

<br>

## 클래스풀 주소 체계

클래스를 기반으로 IP 주소를 관리하는 주소 체계

### 클래스

- 네트워크 크기에 따라 IP 주소를 분류하는 기준
- 클래스를 이용하면 필요한 호스트 IP 개수에 따라 네트워크 크기를 가변적으로 조정할 수 있다.
- 총 5개의 클래스가 있다. (A,B,C,D,E / D,E → 멀티캐스트를 위한 클래스)

A클래스

네트워크 주소는 비트 0으로 시작하고 1옥텟으로 구성된다.

→ $2^7$ 개의 A클래스 네트워크가 존재할 수 있고,  $2^{24}$개의 호스트 주소를 가질 수 있다.

⇒ 가장 처음 옥텟의 주소가 0~127일 경우 A 클래스 주소임을 짐작할 수 있다.

B클래스

네트워크 주소는 비트 10 으로 시작하고 2옥텟으로 구성된다.

⇒ 가장 처음 옥텟의 주소가 128~191일 경우 B 클래스 주소임을 짐작할 수 있다.

C클래스

네트워크 주소는 비트 110 으로 시작하고 2옥텟으로 구성된다.

⇒ 가장 처음 옥텟의 주소가 192~223일 경우 C 클래스 주소임을 짐작할 수 있다.

<br>

> 호스트의 주소 공간을 모두 사용할 수 있는 것은 아니다.
> 

호스트 주소가 전부 0인 IP 주소와 호스트 주소가 전부 1인 IP 주소는 특정 호스트를 지칭하는 IP 주소로 활용할 수 없다.

호스트 주소가 전부 0 → 해당 네트워크 자체를 의미하는 네트워크 주소

호스트 주소가 전부 1 → 브로드 캐스트를 위한 주소로 사용

| 클래스 | 초기 비트 | 네트워크 주소 비트 / 호스트 주소 비트 | 할당 가능한 네트워크 수 | 할당 가능한 호스트 수 |
| --- | --- | --- | --- | --- |
| A | 0 | 8 / 24 | 2⁷ (128) | 2²⁴ (16,777,216) − 2 |
| B | 10 | 16 / 16 | 2¹⁴ (16,384) | 2¹⁶ (65,536) − 2 |
| C | 110 | 24 / 8 | 2²¹ (2,097,152) | 2⁸ (256) − 2 |

<br>

## 클래스리스 주소 체계

클래스풀 주소 체계를 이용하면 공간을 유동적으로 관리할 수 있지만, 

클래스별 네트워크의 크기가 고정되어 있기에 여전히 다수의 IP주소가 낭비될 가능성이 크다는 문제가 있다.

→ 클래스리스 주소 체계

<br>

### 서브넷 마스크

클래스풀 주소 체계는 클래스를 이용해 네트워크 주소와 호스트 주소를 구분하지만,

클래스리스 주소 체계는 네트워크와 호스트를 구분 짓는 수단으로 서브넷 마스크를 이용한다.

- IP 주소 상에서 네트워크 주소는 1, 호스트 주소는 0으로 표기한 비트열을 의미
- 네트워크 내의 부분적인 네트워크를 구분 짓는 비트열

<aside>

>서브넷 <br>
>: IP주소의 네트워크 주소로 구분 가능한 네트워크의 부분 집합 <br>
>서브네팅 <br>
>: 서브넷 마스크를 이용해 클래스를 원하는 크기로 더 잘개 쪼개어 사용하는 것

</aside>

Ex) A 클래스의 기본 서브넷 마스크

A 클래스 : 255.0.0.0 (11111111.00000000.00000000.00000000)

<br>

### 서브네팅 : 비트 AND 연산

네트워크 주소와 호스트 주소를 구분 짓는 방법은 IP주소와 서브넷 마스크를 비트 AND 연산하면 된다.

Ex) IP 주소 : 192.168.219.103, 서브넷 마스크 255.255.255.0

→ AND 연산 → 192.168.219.0 : 네트워크 주소

<br>

### 서브넷 마스크 표기 : CIDR

‘IP 주소 / 서브넷 마스크 상의 1의 개수’ 형식으로 표기하는 방법이다.

Ex) IP 주소 : 192.168.219.103, 서브넷 마스크 255.255.255.0

→ 192.168.219.103/24

<br>

## 공인 IP 주소와 사설 IP 주소

### 공인 IP 주소

- 전 세계에서 고유한 IP주소이다.
- ISP나 공인 IP 주소 할당 기관을 통해 할당받을 수 있다.

<br>

### 사설 IP 주소

- 사설 네트워크에서 사용하기 위한 IP 주소
- 인터넷, 외부 네트워크에 공개되지 않은 네트워크를 의미

IP 주소 공간 중에서 사설 IP 주소로 사용하도록 특별히 예약된 IP 주소 공간이 있다.

- 10.0.0.0/8
- 172.16.0.0/12
- 192.168.0.0/16

<br>

사설 IP 주소의 할당 주체는 일반적으로 라우터이다.

할당받은 사설 IP 주소는 해당 호스트가 속한 사설 네트워크 상에서만 유효한 주소이므로,

얼마든지 다른 네트워크 상의 사설 IP주소와 중복될 수 있다.

→ 인터넷 접속을 비롯한 외부 네트워크 간의 통신이 어렵다.

(인터넷은 ‘공인 IP 주소’를 기반으로 통신하기 때문에)

<br>

사설 IP 주소를 사용하는 호스트가 외부 네트워크와 통신하려면?

→ NAT

### NAT

- IP 주소를 변환하는 기술
- 주로 네트워크 내부에서 사용되는 사설 IP 주소와 네트워크 외부에서 사용되는 공인 IP 주소를 변환하는데 사용된다.
- 대부분의 라우터와 공유기는 NAT 기능을 내장하고 있다.

1. 사설 네트워크 상에서 만들어진 패킷 속 사설 IP 주소는 공유기를 거쳐 공인 IP로 변경되고, 외부 네트워크로 전송된다.
2. 외부 네트워크로부터 받은 패킷 속 공인 IP 주소는 공유기를 거쳐 사설 IP 주소로 변경되어 호스트에 이르게 된다.

<br>

## 정적 IP 주소와 동적 IP 주소

### 정적 할당

- 호스트에 직접 수작업으로 IP 주소를 부여하는 방식
- 이렇게 할당된 IP 주소를 정적 IP 주소라고 부른다.

### 동적 할당

- 호스트에 IP 주소가 동적으로 할당되는 방식
- 이렇게 할당된 주소를 동적 IP 주소라고 부른다.
    - 사용되지 않을 경우 회수되고, 할당 받을 때마다 다른 주소를 받는다.

### DHCP

- IP 동적 할당에 사용되는 대표적인 프로토콜
- 주소를 할당받고자 하는 호스트와 해당 호스트에게 IP 주소를 제공하는 DHCP 서버간에 메시지를 주고 받음으로써 이루어진다.

DHCP 서버

- DHCP 서버의 역할은 일반적으로 라우터가 수행
- 특정 호스트에 DHCP 서버 기능을 추가할 수도 있다.
- 클라이언트에게 할당 가능한 IP 주소 목록을 관리하다가, 클라이언트가 요청할 때 IP 주소를 할당

<br>

### 클라이언트와 DHCP 서버 간에 주고 받는 메시지

1. DHCP Discover
    1. 클라이언트는 DHCP Discover 메시지를 통해 DHCP 서버를 찾는다. (브로드캐스트로 전송)
    2. 전송 시점에 클라이언트는 IP 주소를 할당받지 못했으므로 송신지 IP 주소는 0.0.0.0
2. DHCP Offer
    1. 서버가 Discover 메시지를 받은 뒤 클라이언트에게 Offer 메시지를 보낸다.
    2. 할당해 줄 IP 주소를 제안한다. (서브넷 마스크, 임대 기간 등의 정보도 포함)
3. DHCP Request
    1. 서버로 IP 주소를 써도 되는지 확인 (브로드 캐스트 전송)
4. DHCP ACK
    1. 최종 승인

> Request를 보낼 때 왜 브로드 캐스트로 보낼까?
> 
1. 여러 DHCP 서버에게 “내가 누구 걸 쓸 건지” 알리기 위해
2. 네트워크의 다른 장치들도 동기화하기 위해
    1. 같은 LAN 안의 스위치, 라우터 등이 “아, 이 MAC 주소가 이 IP를 썼구나” 하고 상태를 업데이트할 수 있다.

IP주소가 반납되면 원칙적으로는 이 과정을 다시 거쳐서 재할당 받아야하지만,

IP 주소 임대 기간이 끝나기 전에 연장할 수 도 있다.

→ 임대 갱신 (기본적으로 임대 기간이 끝나기 전에 두 차례 자동으로 수행된다.)
