# 라우팅

### 라우팅

- 패킷이 이동할 최적의 경로를 설정한 뒤 해당 경로로 패킷을 이동시키는 것


### 라우팅 테이블

- 특정 수신지까지 도달하기 위한 정보를 명시한 일종의 표와 같은 정보
- 라우팅 테이블에 포함된 정보는 라우팅 방식에 따라, 호스트의 환경에 따라 달라진다.

<br>

### 라우팅 테이블의 공통적인 정보이자 핵심 정보

- 수신지 IP 주소와 서브넷 마스크
    - 최종적으로 패킷을 전달할 대상을 의미
- 다음 홉
    - 최종 수신지까지 가기 위해 다음으로 거쳐야 할 호스트의 IP 주소나 인터페이스를 의미
    - 게이트웨이라고 명시되기도 한다.
- 네트워크 인터페이스
    - 패킷을 내보낼 통로
    - 인터페이스(NIC) 이름이 직접적으로 명시되거나 인터페이스에 대응하는 IP주소가 명시되기도 한다.
- 매트릭
    - 해당 경로로 이동하는 데에 드는 비용을 의미

<br>

### 디폴트 라우트

패킷 내의 수신지 IP 주소가 라우팅 테이블에 있는 수신지 IP주소, 서브넷 마스크 항목과 완벽하게 합치되는 경우도 있지만, 아닌 경우도 있다.

→ 테이블에 없는 경로로 패킷을 전송해야 할 경우

이 경우 기본적으로 패킷을 내보낼 경로를 설정하여 해당 경로로 패킷을 내보낸다.

⇒ 디폴트 라우트 : 테이블에 없는 경로로 패킷을 전송해야 할 때의 기본 경로

- 모든 IP 주소를 의미하는 0.0.0.0/0 으로 명시한다.
- 기본 게이트웨이로 나아가기 위한 경로

<br>

## 정적 라우팅과 동적 라우팅

### 정적 라우팅

- 사용자가 수동으로 직접 채워 넣은 라우팅 테이블의 항목을 토대로 라우팅되는 방식

### 동적 라우팅

네트워크의 규모가 커지고 관리해야 할 라우터가 늘어나면 정적 라우팅만으로는 관리가 버겁다.

- 자동으로 라우팅 테이블 항목을 만들고, 이를 이용하여 라우팅하는 방식
- 라우팅 테이블 항목이 수시로 변할 수 있다.
- 경로 상에 문제가 발생했을 때 이를 우회할 수 있게 경로가 자동으로 갱신되기도 한다.

<br>

### AS (Autonomous System)

- 동일한 라우팅 정책으로 운용되는 라우터들의 집단 네트워크
- 한 회사나 단체에서 관리하는 라우터 집단이라고 생각해도 된다.
- AS마다 인터넷상에서 고유한 AS번호가 할당된다.
- 한 AS 내에는 다수의 라우터가 있다.
- 라우터들은 AS 내부에서만 통신할 수도 있고, 외부와 통신할 수도 있다.
    - AS 외부와 통신할 경우 AS 경계에서 AS 내외로 통신을 주고 받을 수 있는 ASBR (AS경계 라우터)라는 특별한 라우터를 이용한다.

<br>

### 어떻게 자동으로 라우팅 테이블 항목을 만들까?

→ 최적의 경로를 찾기 위해 라우터끼리 서로 자신의 정보를 교환한다. (라우팅 프로토콜)

### 라우팅 프로토콜

- 라우터끼리 자신들의 정보를 교환하며 패킷이 이동할 최적의 경로를 찾기 위한 프로토콜
- 크게 AS 내부, 외부에서 수행되느냐에 따라 종류를 나눌 수 있다.
    - 내부 : IGP / 외부 : EGP
        - 대표적인 IGP : RIP, OSPF
        - 대표적인 EGP : BGP

<br>

### IGP : RIP와 OSPF

- RIP
    - 최적의 경로를 선정하는 과정에서 거리 벡터를 사용
    - 거리는 패킷이 경유한 라우터의 수(홉의 수)를 의미한다.
    - 인접한 라우터끼리 경로 정보를 주기적으로 교환하며 라우팅 테이블을 갱신한다.

⇒ 특정 수신지에 도달하기 까지 홉 수가 가장 적은 경로를 최적의 경로라고 판단한다.

<br>

- OSPF
    - 최적의 경로를 선정하는 과정에서 링크 상태를 사용
    - 링크 정보를 비롯한 현재 네트워크의 상태를 그래프의 형태로 링크 상태 데이터베이스에 저장한다.
        - 링크 상태 데이터베이스에는 라우터들의 연결 관계, 연결 비용 등 현재 네트워크의 상태를 그래프로 표현하기 위한 데이터가 저장되어 있다.
    - RIP와 달리, OSPF는 네트워크의 구성이 변경되었을 때 라우팅 테이블이 갱신된다.
        - 네트워크의 규모가 매우 커졌을 때 링크 상태 데이터베이스에 모든 정보를 저장하기 어렵다.
        - AS를 에어리어라는 단위로 나누고, 구분된 에어리어 내에서만 링크 상태를 공유한다.
        - 에어리어 경계에 있는 ABR이라는 라우터가 에어리어 간의 연결을 담당한다.

⇒ 최적의 경로를 결정하기 위해 대역폭을 기반으로 매트릭을 계산한다.

대역폭이 높은 링크일수록 매트릭이 낮은 경로로 인식한다.

<br>

### EGP : BGP

- AS 간의 통신에서 사용되는 대표적인 프로토콜
- BGP로 AS 내 라우터 간 통신도 가능하다.
    - AS 간의 통신을 위한 BGP는 eBGP, AS 내의 통신을 위한 BGP는 iBGP라고 한다.

서로 다른 AS가 경로 정보를 교환하기 위해서는 각 AS의 eBGP 라우터가 서로 연결되어 피어 관계를 맺어야 한다.

<br>

피어

- BGP 메시지를 주고 받을 수 있도록 연결된 BGP 라우터
- 동일한 AS내의 피어를 내부 피어, 다른 AS 내의 피어를 외부 피어라 한다.

AS와의 BGP 연결을 유지하기 위해서는 BGP 라우터끼리 연결되어 피어가 되어야 한다.

→ 이렇게 피어 관계가 되도록 연결되는 과정을 **피어링**이라 한다.

- BGP는 RIP와 OSPF에 비해 최적의 경로를 결정하는 과정이 복잡하고, 일정하지 않은 경우가 많다.
    - 경로 결정 과정에서 수신지 주소와 더불어 다양한 속성과 정책이 고려되기 때문

BGP의 속성

- 경로에 대한 일종의 부가 정보
- 대표적인 속성
    - AS-PATH
    - NEXT-HOP
    - LOCAL-PREF

<br>

### AS-PATH 속성

- 메시지가 수신지에 이르는 과정에서 통과하는 AS들의 목록을 의미
    - 메시지가 AS를 거칠 때마다 AS-PATH에 거쳐 간 AS가 추가된다.

Ex) AS1 → AS2 일 때,

곧장 간다면 AS-PATH는 ‘AS2’

AS3를 거쳐 간다면 AS-PATH는 ‘AS3 AS2’

특징

- BGP는 AS 간 라우팅을 할 때 거치게 될 ‘라우터’의 수가 아닌 ‘AS’의 수를 고려한다.
    - AS-PATH가 더 짧은 경로라 할지라도 홉 수가 더 많을 수 있다.
- BGP는 RIP처럼 단순히 수신지에 이르는 ‘거리’가 아닌, 메시지가 어디를 거쳐 어디로 이동하는지를 나타내는 ‘경로’를 고려한다.
    - 이 때문에 BGP는 경로 벡터 라우팅 프로토콜의 일종이라고 부르기도 한다.


<br>

### NEXT-HOP 속성

- 다음 홉, 다음으로 거칠 라우터의 IP주소를 나타낸다.

<br>

### LOCAL-PREF 속성

- 지역 선호도
- AS 내부에서 어떤 외부 경로를 선호할지에 대한 척도를 나타내는 속성
- 일반적으로 BGP의 경로 선택 순서에서 상위 우선순위 속성 중 하나이다.
- 값이 클 수록 우선으로 선택된다.
- AS 관리 주체가 설정하는 정책의 영향을 받는다.

<br>

### BGP의 정책

- AS 간 라우팅에 있어 경로를 선택하는 중요한 판단 기준 중 하나
- AS 관리 주체에 따라 각기 다른 상업적/정치적 목적으로 상이한 정책을 사용
