## 안정성을 위한 기술

### 안정성

- 특정 기능을 언제든 균일한 성능으로 수행할 수 있는 특성
<br>

### 가용성

- 안정성의 정도를 나타내는 용도
- 컴퓨터 시스템이 특정 기능을 실제로 수행할 수 있는 시간의 비율

<img width="252" height="97" alt="Image" src="https://github.com/user-attachments/assets/90d939db-8f99-44d7-b3bb-c841e62cd7b1" />

업 타임 : 정상적인 사용 시간

다운 타임 : 정상적인 사용이 불가능한 시간

⇒ 결괏값이 크다면 고가용성(HA)

> 일반적으로 안정적이라고 평가받는 시스템은 99.999%이상을 목표로 한다.
> 

> 결함 감내 : 문제가 발생하더라도 기능할 수 있는 능력
가용성을 높이기 위해서는 결함을 감내할 수 있도록 설계하는 것이 중요하다.
> 

<br>

### 이중화

- 무언가를 이중으로 두는 기술
    - 대상들은 대부분 문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상이다. → 단일 장애점(SPOF)
- 결함을 감내하여 가용성을 높이기 위한 가장 기본적이고 대표적인 방법
- Ex) SPOF : 라우터
    - 라우터가 고장나면 서버로부터 제공받는 서비스 전체가 동작하지 않는다.

<br>

### 이중화 구성

액티브 : 가동 상태를 의미

스탠바이 : 액티브의 백업으로서 대기하는 상태를 의미

1. 액티브 / 스탠바이
    1. 한 시스템은 가동하고, 다른 시스템은 백업 용도로 대기 상태로 두는 이중화 구성 방식
    2. 액티브 상태인 시스템에 문제가 발생할 경우 스탠바이 시스템이 자동으로 액티브 시스템을 대신하여 작동한다.
    3. 안전하지만, 하나의 장비를 사용할 때에 비해 성능상의 큰 변화가 없다.
2. 액티브 / 액티브
    1. 두 시스템 모두를 가동 상태로 두는 구성 방식
    2. 부하 분산 가능, 성능 상 이점 존재
    3. 한 시스템에 문제가 발생하면 다른 시스템에 부하가 급증하여 문제 발생 가능

<br>

### 다중화

- 이중화 기술이 확장되어 무언가를 여러 개 두는 기술
- 이중화된 구성에 비해 안정적이다.

<br>

### 로드 밸런싱의 필요성

- (서버 입장에서) 서버를 다중화했더라도 트래픽 분배의 문제가 남게 된다.
    - 트래픽
        - 서버의 가용성에 큰 영향을 끼치는 요소
        - 주어진 시점에 네트워크를 경유한 데이터의 양을 의미
        
        → 주어진 시점에 특정 노드를 경유한 패킷의 양 (일반적으로 트래픽 측정은 노드에서 이루어지므로)
        
- 서버에 과도한 트래픽이 몰리게 된다면?
    - CPU 발열
    - 메모리 공간 부족
    - 응답이 느려지거나 일부 요청에 대한 응답 누락 가능성
    - 프로그램의 일관성 손상
    
    ⇒ 서버의 가용성을 떨어트림
    
<br>

### 로드 밸런싱

- 트래픽의 고른 분배를 위해 사용되는 기술
- 로드 밸런서에 의해 수행된다.
    - Ex) L4 스위치, L7 스위치, HAProxy, …
- 일반적으로 이중화나 다중화된 서버와 클라이언트 사이에 위치한다.
- 클라이언트들은 로드 밸런서에 요청을 보내고, 로드 밸런서는 해당 요청을 각 서버에 균등하게 분배한다.

<img width="599" height="295" alt="Image" src="https://github.com/user-attachments/assets/acdf5e8e-644f-44e7-8880-f2639fc36b58" />

<br>

### 헬스 체크

- 다중화된 서버 환경에서 어떤 서버에 문제가 생긴다면 다른 서버들이 이를 빠르게 감지할 수 있어야 함
    
    → 문제가 없는지 주기적으로 검사하는 경우가 많다.
    
    ⇒ 헬스 체크
    
- 주로 로드 밸런서에 의해 이루어지는 경우가 많다.

<br>

### 로드 밸런싱 알고리즘

- 요청을 전달할 수 있는 서버가 여러 개 있을 경우 부하가 균등하게 분산되도록 부하 대상을 선택하는 방법

<br>

### 로드 밸런싱 알고리즘 종류

- 라운드 로빈 알고리즘
    - 단순히 서버를 돌아가며 부하를 전달
    - 서버에 가중치를 부여한다면 가중치 라운드 로빈 알고리즘
- 최소 연결 알고리즘
    - 연결이 적은 서버부터 우선적으로 부하를 전달
    - 서버에 가중치를 부여한다면 가중치 최소 연결 알고리즘

Ex) 가중치 라운드 로빈 알고리즘

<img width="681" height="403" alt="Image" src="https://github.com/user-attachments/assets/8f196ef6-fbaf-4e30-a5d9-ac20d607b6c2" />

<br>

## 포워드 프록시와 리버스 프록시

### 오리진 서버

- 자원을 생성하고 클라이언트에게 권한 있는 응답을 보낼 수 있는 HTTP 서버

<img width="720" height="212" alt="Image" src="https://github.com/user-attachments/assets/3eaafd16-c983-421f-bc78-a37ab74cedbd" />

<br>

### 프록시와 게이트웨이

### 프록시(포워드 프록시)

- 클라이언트가 선택한 메시지 전달 대리자
- 주로 캐시 저장, 클라이언트 암호화 및 접근 제한 등의 기능을 제공한다.

### 게이트웨이(리버스 프록시)

프록시와 비슷하지만 클라이언트가 아니라 서버쪽에서 동작하는 중개자

- 아웃바운드 연결에 대해 오리진 서버 역할 (내부 → 외부)
- 수신된 요청을 변환하여 다른 인바운드 서버들로 전달하는 중개자 역할
    - 클라이언트의 요청을 받은 후, 그 요청을 다른 서버로 전달하는 역할을 한다.
    - Ex) 특정 요청을 서버 A로 보내고, 다른 요청을 서버 B로 보내거나, 요청 형식을 변환해서 전달하는 작업
- 캐시 저장, 로드 밸런서로 동작할 수도 있다.

> 인바운드 메시지 : 오리진 서버를 향하는 메시지
아웃바운드 메시지 : 클라이언트를 향하는 메시지
> 

<img width="727" height="249" alt="Image" src="https://github.com/user-attachments/assets/164a5613-8c19-4a42-90e2-2b4326b2af36" />

Ex) 

다중화된 오리진 서버들의 네트워크 → 오리진 서버들이 사는 대저택

프록시 → 클라이언트를 대신해 대저택에 심부름을 가는 심부름꾼

게이트웨이 → 대저택을 지키는 경비
