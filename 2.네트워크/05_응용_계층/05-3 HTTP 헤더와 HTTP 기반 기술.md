# HTTP 헤더와 HTTP 기반 기술

## 필드 라인

- HTTP 메세지의 두 번째 줄
- 다양한 HTTP 헤더들이 명시된다.

## HTTP 헤더

- 필드 이름(헤더 이름)과 필드 값(헤더 값)이 콜론을 기준으로 구분되어 있다.

## 요청시 활용되는 HTTP 헤더

### 1. Host

- 요청을 보낼 호스트를 나타내는 헤더
- 주로 도메인 네임으로 명시되며, 포트 번호가 포함되어 있을 수 있다.

### 2. User-Agent

- Host 헤더와 더불어 HTTP 요청 메세지에서 가장 흔히 볼 수 있는 헤더
- 웹 브라우저와 같이 HTTP 요청을 시작하는 클라이언트 측의 프로그램을 의미
- 요청 메시지 생성에 관여한 클라이언트 프로그램과 관련된 다양한 정보가 명시된다.

![image.png](attachment:e9e95972-1ae3-4c73-9890-5c701505f543:image.png)

⇒ 서버 입장에서는 User-Agent 헤더를 통해 클라이언트의 접속 환경을 유추할 수 있다.

### 3. Referer

- 클라이언트가 요청을 보낼 때 머무르고 있던 URL이 명시된다.

⇒ 클라이언트의 유입 경로를 파악할 수 있다.

### 4. Authorization

- 클라이언트의 인증 정보를 담는 헤더
- 인증 타입과 인증을 위한 정보가 차례로 명시된다.
    - Ex) Authorization : <type> <credentials>
        - Ex) Type - Basic (가장 기본적인 HTTP 인증 타입)
        - username:password와 같이 아이디와 비밀번호를 콜론을 이용해 합친 뒤, 이를 Base64 인코딩한 값을 인증 정보로 삼는다.

## 응답 시 활용되는 HTTP 헤더

### 1. Server

- 요청을 처리하는 서버 측의 소프트웨어와 관련된 정보를 명시한다.

### 2. Allow

- 클라이언트에게 허용된 HTTP 메서드 목록을 알려주기 위해 사용된다.
- 405(Method Not Allowed)를 응답하는 메시지에 함께 사용된다.

![image.png](attachment:b611d983-def2-40b0-a89a-f1b3e8732006:image.png)

### 3. Retry-After

- 상태 코드 503 → 현재는 요청을 처리할 수 없으나 추후 가능할 수도 있음
- 503 응답과 함께 사용될 수 있는 헤더이다.
- 자원을 사용할 수 있는 날짜 혹은 시각을 나타낸다.

![image.png](attachment:1df98cc2-37b4-4db1-9871-d701ed84c439:image.png)

### 4. Location

- 클라이언트에게 자원의 위치를 알려주기 위해 사용되는 헤더
- 리다이렉션이 발생했을 때나 새로운 자원이 생성되었을 때 사용된다.

### 5. WWW-Authenticate

- 상태 코드 401 → 요청한 자원에 대한 유효한 인증이 없을 때 응답하는 코드
- 상태 코드 401과 함께 사용된다.
- 자원에 접근하기 위한 인증 방식을 설명하는 헤더이다.
- 보안 영역을 함께 알려주거나 인증에 사용될 문자 집합도 알려줄 수 있다.

![image.png](attachment:f224fcfd-e8c2-4274-acac-4e30e04b3d0c:image.png)

### 인증되지 않은 클라이언트가 HTTP 인증을 수행하는 과정

![image.png](attachment:2a7f4eba-d859-4dd5-8699-2f124a019c81:image.png)

1. 인증되지 않은 클라이언트가 서버에 GET 요청
2. 서버는 클라이언트에게 상태코드 401과 함께 WWW-Authenticate 헤더를 통해 인증 방식을 알림
3. 클라이언트는 사용자로부터 인증 정보를 전달 받음
4. 사용자 아이디:비밀번호를 인코딩한 값을 인증 정보로 삼은 Authorization 헤더를 통해 다시 GET 요청
5. 서버는 인증 정보를 확인
6. 인증이 유효하면 상태코드 200, 인증되지 않았으면 상태코드 401

## 요청과 응답 모두에서 활용되는 HTTP 헤더

### 1. Date

- 메시지가 생성된 날짜와 시각에 관련된 정보를 담은 헤더

### 2. Connection

- 클라이언트의 요청과 응답 간의 연결 방식을 설정하는 헤더
- 다양한 값이 명시될 수 있지만 가장 대표적으로 아래 두 가지가 있다.
- Connection: keep-alive
    - 상대방에게 지속 연결을 희망함을 알림
- Connection: close
    - 서버나 클라이언트가 연결을 종료하고 싶을 때

### 3. Content-Length

- 본문의 바이트 단위 크기를 나타낸다.

### 4. Content-Type, Content-Language, Content-Encoding

- 전송하려는 메시지 본문의 표현 방식을 설명하는 헤더
- 표현 헤더의 일종이라고도 부른다.
- Content-Type
    - 메시지 본문에서 사용된 미디어 타입을 담고 있다.
- Content-Language
    - 메시지 본문에 사용된 자연어를 명시한다. → 어떤 언어로 작성되었는지 알 수 있다.
    - 언어 태그로 명시된다.
        - 첫 번째 서브 태그는 언어 코드로 특정 언어를 의미하는 언어 코드가 명시된다.
        - Ex) 한국어 - ko / 영어 - en
        - 두 번재 서브 태그는 국가 코드로, 특정 국가를 의미하는 국가 코드가 명시된다.
        - Ex) 한국 - KR / 미국 - US
        - ⇒ Ex) en-US or ko_KR
- Content-Encoding
    - 메시지 본문을 압축하거나 변환한 방식이 명시된다.
    - Ex) gzip, compress …

## HTTP 기반 기술

## 캐시

- 불필요한 대역폭 낭비와 응답 지연을 방지하기 위해 정보의 사본을 임시로 저장하는 기술
    
    → 사본을 임시로 저장해두면 동일한 요청에 대해 캐시된 데이터를 활용할 수 있기 때문에 불필요한 대역폭 낭비를 줄일 수 있고, 더 빠르게 데이터에 접근할 수 있다.
    
- 웹 브라우저에 저장된 캐시 → 개인 전용 캐시
- 클라이언트와 서버 사이에 위치한 중간 서버에 저장된 캐시 → 공용 캐시

### 캐시 신선도

- 사본 데이터가 얼마나 최신 원본 데이터와 유사한지를 나타낸 것
- 캐시된 데이터에 유효기간을 설정하는 방법으로 신선도를 유지한다.
- 캐시된 자원이 여전히 최신 정보라면 클라이언트는 굳이 서버로부터 같은 자원을 응답받을 필요가 없다 → 캐시 신선도 재검사

### 캐시 신선도 재검사 방법

- 날짜를 기반으로 재검사
    - 클라이언트는 If-Modified-Since헤더를 통해 서버에게 특정 시점 이후로 원본 데이터에 변경이 있었는지 물어볼 수 있다.
    
    ![image.png](attachment:84ae4879-3817-4dbe-acf8-3f52e05158db:image.png)
    
    - 요청 받은 자원이 변경되었다면 → 새로운 자원 반환(200)
    - 변경되지 않았다면 → 자원이 변경되지 않았음을 알림(304)
    - 요청 받은 자원이 삭제되었다면 → 존재하지 않음을 알림(404)
    
    ![image.png](attachment:812e9f3c-8a20-4f3a-b60a-e9518dfc9e0b:image.png)
    

- 엔티티 태그(Etag)를 기반으로 재검사
    - Etag : 자원의 버전을 식별하기 위한 정보
        - 버전 : 유의미한 변경 사항
        
        → 자원이 변경될 때마다 Etag 값이 변경된다.
        
    - 클라이언트가 신선도를 검사하기 위해 서버에게 Etag값과 일치하는 자원이 있는지 물어본다. (If-None-Match 헤더 이용)
    - 자원이 변경되었다면 → 200
    - 변경되지 않았다면 → 304
    - 삭제되었다면 → 404

## 쿠키

- 서버에서 생서되어 클라이언트 측에 저장되는 데이터
- 상태를 유지하지 않는 HTTP의 특성을 보완하기 위한 수단
- <이름, 값> 쌍의 형태를 띠고 있고, 다양한 속성을 가질 수 있다.

1. 서버는 쿠키를 생성하여 클라이언트에 전송
2. 클라이언트는 전달받은 쿠키를 저장해 두었다가 추후 동일한 서버에 보내는 요청 메시지에 쿠키를 포함하여 전송한다.

- 응답 메시지의 Set-Cookie 헤더와 요청 메시지의 Cookie 헤더를 통해 전달된다.

![image.png](attachment:f050327b-fcd0-4199-8dd8-788f23a06e92:image.png)

![image.png](attachment:11d28fbe-6eee-4b48-9afb-460e1d7356c8:image.png)

- domain : 도메인을 구분하기 위해
- path : 같은 도메인이고 경로별로 쿠키를 구분하여 사용하고 싶을 때
- Expires/Max-Age : 쿠키의 유효 기간
- 보안 측면에서 한계가 있다.

## 콘텐츠 협상과 표현

### 콘텐츠 협상

- 같은 URI에 대해 가장 적합한 자원의 형태로 제공하는 메커니즘
- Ex) 영어로 요청하면 영어로된 형태, 한국어로 요청하면 한국어로 된 형태 제공

### 표현

- 송수신 가능한 자원의 형태

### 콘텐츠 협상 관련 HTTP 헤더

- Accept 헤더 → 선호하는 미디어 타입
- Accept-Language → 선호하는 언어
- Accept-Charset,Accept-Encoding → 문자 인코딩 & 압축 방식

### 콘텐츠 협상 선호도 우선순위

- 선호도에 우선순위를 반영할 수 있다.
- 헤더의 q값(Quality-Value) 으로 표현된다.
    - 생략되었을 경우 1을 의미
    - 범위 : 0~1
    - 값이 클수록 우선 순위가 높다.

![image.png](attachment:630f7092-cdb5-47e6-b1a7-1c51f89051a2:image.png)